From 5154082bde54ba8a3514604f58edc1217d497a10 Mon Sep 17 00:00:00 2001
From: "h.udo" <hudokkow@gmail.com>
Date: Wed, 6 Jan 2016 15:08:51 +0000
Subject: [PATCH 1/2] [src] Update to p8-platform

---
 src/Socket.cpp                       |  2 +-
 src/client.h                         |  2 +-
 src/lib/tsreader/DeMultiplexer.cpp   |  2 +-
 src/lib/tsreader/DeMultiplexer.h     |  4 ++--
 src/lib/tsreader/FileReader.cpp      |  6 +++---
 src/lib/tsreader/FileReader.h        |  4 ++--
 src/lib/tsreader/MultiFileReader.cpp | 10 +++++-----
 src/lib/tsreader/TSReader.cpp        |  2 +-
 src/lib/tsreader/TSReader.h          |  2 +-
 src/os-dependent.h                   |  2 +-
 src/pvrclient-mediaportal.cpp        | 10 +++++-----
 src/pvrclient-mediaportal.h          |  6 +++---
 src/timers.cpp                       |  2 +-
 src/utils.cpp                        |  2 +-
 src/utils.h                          |  4 ++--
 src/windows/FileUtils.cpp            |  4 ++--
 16 files changed, 32 insertions(+), 32 deletions(-)

diff --git a/src/Socket.cpp b/src/Socket.cpp
index f9c8c39..9db5213 100644
--- a/src/Socket.cpp
+++ b/src/Socket.cpp
@@ -19,7 +19,7 @@
 #include "kodi/libXBMC_addon.h"
 #include "utils.h"
 #include <string>
-#include "platform/os.h"
+#include "p8-platform/os.h"
 #include "client.h"
 #include "Socket.h"
 
diff --git a/src/client.h b/src/client.h
index d385632..876b6cb 100644
--- a/src/client.h
+++ b/src/client.h
@@ -24,7 +24,7 @@
 #ifndef CLIENT_H
 #define CLIENT_H
 
-#include "platform/util/StdString.h"
+#include "p8-platform/util/StdString.h"
 #include "kodi/libXBMC_addon.h"
 #include "kodi/libXBMC_pvr.h"
 #include "kodi/libKODI_guilib.h"
diff --git a/src/lib/tsreader/DeMultiplexer.cpp b/src/lib/tsreader/DeMultiplexer.cpp
index 1f3fa81..11b3503 100644
--- a/src/lib/tsreader/DeMultiplexer.cpp
+++ b/src/lib/tsreader/DeMultiplexer.cpp
@@ -103,7 +103,7 @@ namespace MPTV
         if (m_filter.IsSeeking())
             return 0;       // Ambass : to check
 
-        PLATFORM::CLockObject lock(m_sectionRead);
+        P8PLATFORM::CLockObject lock(m_sectionRead);
         if (NULL == m_reader)
             return false;
 
diff --git a/src/lib/tsreader/DeMultiplexer.h b/src/lib/tsreader/DeMultiplexer.h
index e0dcb89..23b5111 100644
--- a/src/lib/tsreader/DeMultiplexer.h
+++ b/src/lib/tsreader/DeMultiplexer.h
@@ -37,7 +37,7 @@
 #include "PacketSync.h"
 #include "TSHeader.h"
 #include "PatParser.h"
-#include "platform/threads/mutex.h"
+#include "p8-platform/threads/mutex.h"
 
 namespace MPTV
 {
@@ -60,7 +60,7 @@ namespace MPTV
     private:
         unsigned long m_LastDataFromRtsp;
         bool m_bEndOfFile;
-        PLATFORM::CMutex m_sectionRead;
+        P8PLATFORM::CMutex m_sectionRead;
         FileReader* m_reader;
         CPatParser m_patParser;
         CTsReader& m_filter;
diff --git a/src/lib/tsreader/FileReader.cpp b/src/lib/tsreader/FileReader.cpp
index 7811a25..8ee7616 100644
--- a/src/lib/tsreader/FileReader.cpp
+++ b/src/lib/tsreader/FileReader.cpp
@@ -35,10 +35,10 @@
 #include "FileReader.h"
 #include "client.h" //for XBMC->Log
 #include "TSDebug.h"
-#include "platform/threads/threads.h"
+#include "p8-platform/threads/threads.h"
 #include <algorithm> //std::min, std::max
-#include "platform/util/timeutils.h" // for usleep
-#include "platform/util/util.h"
+#include "p8-platform/util/timeutils.h" // for usleep
+#include "p8-platform/util/util.h"
 #include "utils.h"
 #include <errno.h>
 
diff --git a/src/lib/tsreader/FileReader.h b/src/lib/tsreader/FileReader.h
index dcb404c..1e743b5 100644
--- a/src/lib/tsreader/FileReader.h
+++ b/src/lib/tsreader/FileReader.h
@@ -33,8 +33,8 @@
  *  http://forums.dvbowners.com/
  */
 
-#include "platform/os.h"
-#include "platform/util/StdString.h"
+#include "p8-platform/os.h"
+#include "p8-platform/util/StdString.h"
 
 namespace MPTV
 {
diff --git a/src/lib/tsreader/MultiFileReader.cpp b/src/lib/tsreader/MultiFileReader.cpp
index 67744b2..1768a3b 100644
--- a/src/lib/tsreader/MultiFileReader.cpp
+++ b/src/lib/tsreader/MultiFileReader.cpp
@@ -38,13 +38,13 @@
 #include <string>
 #include "utils.h"
 #include <algorithm>
-#include "platform/util/timeutils.h"
-#include "platform/util/StdString.h"
-#include "platform/threads/threads.h"
+#include "p8-platform/util/timeutils.h"
+#include "p8-platform/util/StdString.h"
+#include "p8-platform/threads/threads.h"
 #include <inttypes.h>
 
 using namespace ADDON;
-using namespace PLATFORM;
+using namespace P8PLATFORM;
 
 //Maximum time in msec to wait for the buffer file to become available - Needed for DVB radio (this sometimes takes some time)
 #define MAX_BUFFER_TIMEOUT 1500
@@ -112,7 +112,7 @@ namespace MPTV
         if (RefreshTSBufferFile() == S_FALSE)
         {
             // For radio the buffer sometimes needs some time to become available, so wait and try it more than once
-            PLATFORM::CTimeout timeout(MAX_BUFFER_TIMEOUT);
+            P8PLATFORM::CTimeout timeout(MAX_BUFFER_TIMEOUT);
 
             do
             {
diff --git a/src/lib/tsreader/TSReader.cpp b/src/lib/tsreader/TSReader.cpp
index d6d93e3..b6521dc 100644
--- a/src/lib/tsreader/TSReader.cpp
+++ b/src/lib/tsreader/TSReader.cpp
@@ -32,7 +32,7 @@
 #include "MultiFileReader.h"
 #include "utils.h"
 #include "TSDebug.h"
-#include "platform/util/timeutils.h"
+#include "p8-platform/util/timeutils.h"
 #ifdef LIVE555
 #include "MemoryReader.h"
 #include "MepoRTSPClient.h"
diff --git a/src/lib/tsreader/TSReader.h b/src/lib/tsreader/TSReader.h
index 03d1cdb..b855be9 100644
--- a/src/lib/tsreader/TSReader.h
+++ b/src/lib/tsreader/TSReader.h
@@ -30,7 +30,7 @@
 
 #include "client.h"
 #include "FileReader.h"
-#include "platform/util/StdString.h"
+#include "p8-platform/util/StdString.h"
 #include "DeMultiplexer.h"
 #include "Cards.h"
 
diff --git a/src/os-dependent.h b/src/os-dependent.h
index faae7b0..5de571d 100644
--- a/src/os-dependent.h
+++ b/src/os-dependent.h
@@ -18,7 +18,7 @@
  *
  */
 
-#include "platform/os.h"
+#include "p8-platform/os.h"
 
 // Additional typedefs
 typedef uint8_t byte;
diff --git a/src/pvrclient-mediaportal.cpp b/src/pvrclient-mediaportal.cpp
index a148635..be88fa0 100644
--- a/src/pvrclient-mediaportal.cpp
+++ b/src/pvrclient-mediaportal.cpp
@@ -21,7 +21,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-#include "platform/util/timeutils.h"
+#include "p8-platform/util/timeutils.h"
 
 #include "client.h"
 #include "timers.h"
@@ -86,7 +86,7 @@ cPVRClientMediaPortal::~cPVRClientMediaPortal()
 
 string cPVRClientMediaPortal::SendCommand(string command)
 {
-  PLATFORM::CLockObject critsec(m_mutex);
+  P8PLATFORM::CLockObject critsec(m_mutex);
 
   if ( !m_tcpclient->send(command) )
   {
@@ -121,7 +121,7 @@ string cPVRClientMediaPortal::SendCommand(string command)
 
 bool cPVRClientMediaPortal::SendCommand2(string command, vector<string>& lines)
 {
-  PLATFORM::CLockObject critsec(m_mutex);
+  P8PLATFORM::CLockObject critsec(m_mutex);
 
   if ( !m_tcpclient->send(command) )
   {
@@ -1043,7 +1043,7 @@ PVR_ERROR cPVRClientMediaPortal::GetRecordings(ADDON_HANDLE handle)
     }
   }
 
-  m_iLastRecordingUpdate = PLATFORM::GetTimeMs();
+  m_iLastRecordingUpdate = P8PLATFORM::GetTimeMs();
 
   return PVR_ERROR_NO_ERROR;
 }
@@ -1235,7 +1235,7 @@ PVR_ERROR cPVRClientMediaPortal::GetTimers(ADDON_HANDLE handle)
     }
   }
 
-  if ( PLATFORM::GetTimeMs() >  m_iLastRecordingUpdate + 15000)
+  if ( P8PLATFORM::GetTimeMs() >  m_iLastRecordingUpdate + 15000)
   {
     PVR->TriggerRecordingUpdate();
   }
diff --git a/src/pvrclient-mediaportal.h b/src/pvrclient-mediaportal.h
index 8345a8b..64168fc 100644
--- a/src/pvrclient-mediaportal.h
+++ b/src/pvrclient-mediaportal.h
@@ -27,7 +27,7 @@
 #include "Socket.h"
 #include "Cards.h"
 #include "epg.h"
-#include "platform/threads/mutex.h"
+#include "p8-platform/threads/mutex.h"
 
 /* Use a forward declaration here. Including RTSPClient.h via TSReader.h at this point gives compile errors */
 namespace MPTV
@@ -35,7 +35,7 @@ namespace MPTV
     class CTsReader;
 }
 
-class cPVRClientMediaPortal: public PLATFORM::PreventCopy
+class cPVRClientMediaPortal: public P8PLATFORM::PreventCopy
 {
 public:
   /* Class interface */
@@ -131,7 +131,7 @@ class cPVRClientMediaPortal: public PLATFORM::PreventCopy
   time_t                  m_BackendTime;
   CCards                  m_cCards;
   CGenreTable*            m_genretable;
-  PLATFORM::CMutex        m_mutex;
+  P8PLATFORM::CMutex        m_mutex;
   int64_t                 m_iLastRecordingUpdate;
   MPTV::CTsReader*        m_tsreader;
   std::map<int,std::string> m_channelNames;
diff --git a/src/timers.cpp b/src/timers.cpp
index 8d8955e..dc6c9a3 100644
--- a/src/timers.cpp
+++ b/src/timers.cpp
@@ -23,7 +23,7 @@
 
 using namespace std;
 
-#include "platform/os.h" //needed for snprintf
+#include "p8-platform/os.h" //needed for snprintf
 #include "client.h"
 #include "timers.h"
 #include "utils.h"
diff --git a/src/utils.cpp b/src/utils.cpp
index e3f1c0a..27d1820 100644
--- a/src/utils.cpp
+++ b/src/utils.cpp
@@ -24,7 +24,7 @@
 #include "utils.h"
 #include <string>
 #include <stdio.h>
-#include "platform/util/StdString.h"
+#include "p8-platform/util/StdString.h"
 
 using namespace std;
 using namespace ADDON;
diff --git a/src/utils.h b/src/utils.h
index 4954948..6d49f0d 100644
--- a/src/utils.h
+++ b/src/utils.h
@@ -20,10 +20,10 @@
 #include <vector>
 #include <ctime>
 #include "uri.h"
-#include "platform/util/util.h"
+#include "p8-platform/util/util.h"
 
 #ifdef TARGET_WINDOWS
-#include "platform/util/StdString.h"
+#include "p8-platform/util/StdString.h"
 #include "windows/WindowsUtils.h"
 #endif
 
diff --git a/src/windows/FileUtils.cpp b/src/windows/FileUtils.cpp
index 3471159..a516a8f 100644
--- a/src/windows/FileUtils.cpp
+++ b/src/windows/FileUtils.cpp
@@ -18,9 +18,9 @@
  */
 
 #include "../FileUtils.h"
-#include "platform/os.h"
+#include "p8-platform/os.h"
 #include <string>
-#include "platform/util/StdString.h"
+#include "p8-platform/util/StdString.h"
 #include "../utils.h"
 
 namespace OS

From f11bd0f6ea1381527d815efa5fef9cd07eb61c0f Mon Sep 17 00:00:00 2001
From: "h.udo" <hudokkow@gmail.com>
Date: Wed, 6 Jan 2016 15:21:35 +0000
Subject: [PATCH 2/2] [cmake] Update to p8-platform

---
 CMakeLists.txt | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 29bd211..9af7dec 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -8,7 +8,7 @@ enable_language(CXX)
 
 find_package(kodi REQUIRED)
 find_package(kodiplatform REQUIRED)
-find_package(platform REQUIRED)
+find_package(p8-platform REQUIRED)
 find_package(TinyXML REQUIRED)
 
 # Grab the addon version info from the addon.xml file
@@ -20,7 +20,7 @@ STRING(REGEX REPLACE ".*version=.([0-9\\.]+).*" "\\1" MPTV_VERSION ${MPTV_VERSIO
 configure_file(src/addon_version.h.in addon_version.h)
 
 include_directories(${kodiplatform_INCLUDE_DIRS}
-                    ${platform_INCLUDE_DIRS}
+                    ${p8-platform_INCLUDE_DIRS}
                     ${TINYXML_INCLUDE_DIR}
                     ${KODI_INCLUDE_DIR}
                     ${PROJECT_SOURCE_DIR}/src
@@ -125,7 +125,7 @@ source_group("Header Files\\lib\\tsreader" FILES ${TSREADER_HEADERS})
 # Make sure that CMake adds all files to the MSVC project
 list(APPEND MPTV_SOURCES ${MPTV_HEADERS} ${TSREADER_SOURCES} ${TSREADER_HEADERS} ${RESOURCE_FILES})
 
-set(DEPLIBS ${platform_LIBRARIES}
+set(DEPLIBS ${p8-platform_LIBRARIES}
             ${TINYXML_LIBRARIES})
 
 if(WIN32)
